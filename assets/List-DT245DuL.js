import{r as p,i as T,j as U,c as k,a as _,f as o,k as j,h as s,g as n,E as m,u as I,o as y,e as r,b as h,t as C,l as K,m as M,n as J}from"./index-DrpxvrEV.js";import{g as L,a as O,b as P}from"./activity-DGlHpSGR.js";import{d as R}from"./api-BAtoe7S3.js";const q={class:"p-4"},F={class:"flex justify-between mb-4"},G={class:"flex items-center"},H={key:0,class:"ml-1 text-green-500"},Q={class:"flex items-center space-x-2"},ee={__name:"List",setup(W){const f=p(""),i=p([]),g=p(0),v=p(1),w=I(),x=async()=>{try{const t=i.value.map(l=>l.id);if(!t.length)return;const e=await P(t);i.value.forEach(l=>{l.enrolled=e.data.data[l.id]??!1})}catch(t){console.error("加载报名状态失败:",t),m.error("加载报名状态失败，请稍后重试")}},u=async()=>{try{const{data:t}=await O({keyword:f.value,page:v.value,size:10});i.value=t.list||[],g.value=t.total||0,i.value.length&&await x()}catch(t){console.error("加载活动列表失败:",t),m.error("加载活动列表失败，请稍后重试")}};function V(){localStorage.removeItem("token"),w.replace("/login")}const b=T(()=>{const t=L();if(!t)return null;try{const e=t.split(".")[1];return JSON.parse(atob(e))}catch{return null}});function E(t){if(!b.value)return!1;const{username:e,role:l}=b.value;return l==="admin"||t.createdBy===e}async function $(t){try{await R(t),m.success("删除成功"),await u()}catch(e){m.error(e?.response?.data?.msg||"删除失败")}}return U(u),(t,e)=>{const l=s("el-input"),c=s("el-button"),B=s("el-icon"),d=s("el-table-column"),N=s("el-tag"),S=s("el-popconfirm"),z=s("el-table"),A=s("el-pagination");return y(),k("div",q,[_("div",F,[o(l,{modelValue:f.value,"onUpdate:modelValue":e[0]||(e[0]=a=>f.value=a),placeholder:"搜索活动名称",onKeyup:j(u,["enter"]),style:{width:"200px"}},null,8,["modelValue"]),o(c,{type:"primary",onClick:u},{default:n(()=>e[3]||(e[3]=[r("搜索",-1)])),_:1,__:[3]}),o(c,{type:"success",onClick:e[1]||(e[1]=a=>t.$router.push("/activity/new"))},{default:n(()=>e[4]||(e[4]=[r("新建活动",-1)])),_:1,__:[4]}),o(c,{type:"danger",onClick:V},{default:n(()=>e[5]||(e[5]=[r("退出登录",-1)])),_:1,__:[5]})]),o(z,{data:i.value,border:""},{default:n(()=>[o(d,{label:"活动名称"},{default:n(({row:a})=>[_("div",G,[_("span",null,C(a.title),1),a.enrolled?(y(),k("span",H,[o(B,{size:"16",color:"#67C23A"},{default:n(()=>[o(K(M))]),_:1})])):h("",!0)])]),_:1}),o(d,{prop:"startTime",label:"开始时间",width:"160"}),o(d,{prop:"location",label:"地点",width:"120"}),o(d,{label:"状态",width:"90"},{default:n(({row:a})=>[o(N,{type:a.status==="online"?"success":"info"},{default:n(()=>[r(C({online:"上线",offline:"下线",draft:"草稿"}[a.status]),1)]),_:2},1032,["type"])]),_:1}),o(d,{label:"操作",width:"200"},{default:n(({row:a})=>[_("div",Q,[o(c,{size:"small",onClick:D=>t.$router.push(`/activity/${a.id}`)},{default:n(()=>e[6]||(e[6]=[r("详情",-1)])),_:2,__:[6]},1032,["onClick"]),E(a)?(y(),J(S,{key:0,title:"确定删除该活动吗？",onConfirm:D=>$(a.id)},{reference:n(()=>[o(c,{size:"small",type:"danger"},{default:n(()=>e[7]||(e[7]=[r("删除",-1)])),_:1,__:[7]})]),_:2},1032,["onConfirm"])):h("",!0)])]),_:1})]),_:1},8,["data"]),o(A,{class:"mt-4 text-right",background:"",layout:"prev, pager, next",total:g.value,"current-page":v.value,"onUpdate:currentPage":e[2]||(e[2]=a=>v.value=a),onCurrentChange:u},null,8,["total","current-page"])])}}};export{ee as default};
